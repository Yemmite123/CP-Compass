{"ast":null,"code":"var _jsxFileName = \"/Users/adebayooluyemi/Documents/THE BULB/cpinvest-app/cpinvest-app/src/pages/App/Support/Tickets/index.js\";\nimport React from 'react';\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { getActionLoadingState } from \"#/store/selectors\";\nimport actionTypes from \"#/store/support/actionTypes\";\nimport { getTickets, createNewTicket, searchTickets } from '#/store/support/actions';\nimport Modal from '#/components/Modal';\nimport DataTable from '#/components/DataTable';\nimport DragDropFileInput from '#/components/DragDropFileInput';\nimport Pagination from '#/components/Pagination';\nimport { validateFields, serializeErrors } from '#/utils';\nimport { columns } from './utils';\nimport './style.scss';\n\nclass Tickets extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      search: '',\n      showNewModal: false,\n      title: '',\n      issue: '',\n      errors: null,\n      files: null,\n      limit: 10,\n      pageNumber: 1\n    };\n    this.imgRef = React.createRef();\n\n    this.handleChange = event => {\n      const {\n        name,\n        value\n      } = event.target;\n      this.setState({\n        [name]: value\n      });\n\n      if (name === 'search' && value === '') {\n        return this.props.getTickets(10, 1);\n      }\n    };\n\n    this.handleFile = file => {\n      this.setState({\n        files: file\n      });\n    };\n\n    this.handleSubmitSearch = event => {\n      event.preventDefault();\n      const {\n        search\n      } = this.state;\n      this.props.searchTickets({\n        search\n      });\n    };\n\n    this.toggleNewModal = () => {\n      this.setState(prevState => ({\n        showNewModal: !prevState.showNewModal\n      }));\n\n      if (this.state.showNewModal) {\n        return this.setState({\n          title: '',\n          fileNames: [],\n          files: [],\n          issue: '',\n          errors: null\n        });\n      }\n    };\n\n    this.submitNewTicket = event => {\n      event.preventDefault();\n      this.setState({\n        errors: null\n      });\n      const {\n        createNewTicket\n      } = this.props;\n      const {\n        title,\n        issue,\n        files\n      } = this.state;\n      const data = this.state;\n      const required = ['title', 'issue'];\n      const errors = validateFields(data, required);\n\n      if (Object.keys(errors).length > 0) {\n        return this.setState({\n          errors\n        });\n      }\n\n      const formData = new FormData(); // const fileToUpload = files && files.length > 1 ? files : files\n      //create a method that checks the files size and appends the right key to it\n\n      if (files) {\n        for (var x = 0; x < files.length; x++) {\n          formData.append(files.length > 1 ? 'attachment' : 'attachment[]', files[x]);\n        }\n      }\n\n      formData.append('title', title);\n      formData.append('description', issue);\n      createNewTicket(formData).then(data => {\n        this.toggleNewModal();\n        return this.props.getTickets(10, 1);\n      });\n    };\n\n    this.naviagetToTicket = id => {\n      this.props.history.push({\n        pathname: `/app/support/ticket/${id}`,\n        state: {\n          routeName: 'Support'\n        }\n      });\n    };\n  }\n\n  componentDidMount() {\n    this.props.getTickets(10, 1);\n  }\n\n  render() {\n    const {\n      search,\n      showNewModal,\n      title,\n      issue,\n      errors\n    } = this.state;\n    const {\n      tickets,\n      newLoading,\n      metadata,\n      loading,\n      error\n    } = this.props;\n    const errorObject = serializeErrors(error);\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"tickets-page\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 7\n      }\n    }, showNewModal && /*#__PURE__*/React.createElement(Modal, {\n      onClose: this.toggleNewModal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      className: \"cursor-pointer\",\n      onClick: this.toggleNewModal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 17\n      }\n    }, '< Back')), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-8 text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      className: \"text-deep-blue\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 17\n      }\n    }, \"Create New Ticket\"))), /*#__PURE__*/React.createElement(\"form\", {\n      className: \"mt-2\",\n      onSubmit: this.submitNewTicket,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row align-items-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-grey mb-0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 19\n      }\n    }, \"Title of Ticket\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-9\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      name: \"title\",\n      value: title,\n      onChange: this.handleChange,\n      className: \"form-control\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"text-error mt-0 mb-0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 19\n      }\n    }, errors ? errors.title : errorObject && errorObject['title']))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row mt-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-grey mb-0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 19\n      }\n    }, \"Describe your issue\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-9\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"textarea\", {\n      name: \"issue\",\n      value: issue,\n      onChange: this.handleChange,\n      className: \"form-control\",\n      placeholder: \"compose your message\",\n      rows: 6,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"text-error mt-0 mb-0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 19\n      }\n    }, errors ? errors.issue : errorObject && errorObject['description']))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row mt-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-grey mb-0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 19\n      }\n    }, \"Attach file\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-9\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(DragDropFileInput, {\n      handleFile: this.handleFile,\n      error: errors ? errors.file : errorObject && errorObject['attachment.0'],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"text-error mt-0 mb-0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 19\n      }\n    }, errors ? errors.file : errorObject && errorObject['attachment.0']), error && typeof error === 'string' && /*#__PURE__*/React.createElement(\"p\", {\n      className: \"text-error mt-2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 58\n      }\n    }, error))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"text-right mt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-sm btn-primary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 17\n      }\n    }, \"Submit\", newLoading && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"spinner-border spinner-border-white spinner-border-sm ml-2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 21\n      }\n    }))))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex justify-content-end mt-2 flex-wrap\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-sm btn-primary mr-2 mb-3\",\n      onClick: this.toggleNewModal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 11\n      }\n    }, \"Create new ticket\"), /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: this.handleSubmitSearch,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      name: \"search\",\n      type: \"text\",\n      placeholder: \"\\uD83D\\uDD0D Search tickets\",\n      className: \"p-2 border-grey border-radius-default mb-3\",\n      value: search,\n      onChange: this.handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 15\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"mt-2 card\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 9\n      }\n    }, loading && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"text-center p-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"spinner-border spinner-border-primary text-primary spinner-border-md mr-2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 15\n      }\n    })), tickets && tickets.length > 0 ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Pagination, {\n      totalPages: metadata.lastPage,\n      page: metadata.page,\n      limit: metadata.perPage,\n      changePageHandler: (limit, page) => this.props.getTickets(limit, page),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"table-class\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(DataTable, {\n      data: tickets,\n      columns: columns,\n      info: metadata,\n      selectItem: this.naviagetToTicket,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 15\n      }\n    }))) : !loading && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"p-5 text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: require('#/assets/icons/receipt.svg'),\n      alt: \"no-tickets\",\n      className: \"img-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"font-light text-grey\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 13\n      }\n    }, search !== ''.trim() ? 'No ticket history matches this search' : 'You have no booked tickets'))));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  const {\n    app: {\n      support: {\n        tickets,\n        error,\n        metadata\n      }\n    }\n  } = state;\n  return {\n    loading: getActionLoadingState(state, actionTypes.GET_TICKETS_REQUEST),\n    newLoading: getActionLoadingState(state, actionTypes.CREATE_NEW_TICKET_REQUEST),\n    tickets,\n    error,\n    metadata\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    getTickets: (limit, pageNumber) => dispatch(getTickets(limit, pageNumber)),\n    createNewTicket: payload => dispatch(createNewTicket(payload)),\n    searchTickets: payload => dispatch(searchTickets(payload))\n  };\n};\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(Tickets));","map":{"version":3,"sources":["/Users/adebayooluyemi/Documents/THE BULB/cpinvest-app/cpinvest-app/src/pages/App/Support/Tickets/index.js"],"names":["React","connect","withRouter","getActionLoadingState","actionTypes","getTickets","createNewTicket","searchTickets","Modal","DataTable","DragDropFileInput","Pagination","validateFields","serializeErrors","columns","Tickets","Component","state","search","showNewModal","title","issue","errors","files","limit","pageNumber","imgRef","createRef","handleChange","event","name","value","target","setState","props","handleFile","file","handleSubmitSearch","preventDefault","toggleNewModal","prevState","fileNames","submitNewTicket","data","required","Object","keys","length","formData","FormData","x","append","then","naviagetToTicket","id","history","push","pathname","routeName","componentDidMount","render","tickets","newLoading","metadata","loading","error","errorObject","lastPage","page","perPage","require","trim","mapStateToProps","app","support","GET_TICKETS_REQUEST","CREATE_NEW_TICKET_REQUEST","mapDispatchToProps","dispatch","payload"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,qBAAT,QAAsC,mBAAtC;AACA,OAAOC,WAAP,MAAwB,6BAAxB;AACA,SAASC,UAAT,EAAqBC,eAArB,EAAsCC,aAAtC,QAA2D,yBAA3D;AACA,OAAOC,KAAP,MAAkB,oBAAlB;AACA,OAAOC,SAAP,MAAsB,wBAAtB;AACA,OAAOC,iBAAP,MAA8B,gCAA9B;AACA,OAAOC,UAAP,MAAuB,yBAAvB;AACA,SAASC,cAAT,EAAyBC,eAAzB,QAAgD,SAAhD;AACA,SAASC,OAAT,QAAwB,SAAxB;AACA,OAAO,cAAP;;AAEA,MAAMC,OAAN,SAAsBf,KAAK,CAACgB,SAA5B,CAAsC;AAAA;AAAA;AAAA,SAEpCC,KAFoC,GAE5B;AACNC,MAAAA,MAAM,EAAE,EADF;AAENC,MAAAA,YAAY,EAAE,KAFR;AAGNC,MAAAA,KAAK,EAAE,EAHD;AAINC,MAAAA,KAAK,EAAE,EAJD;AAKNC,MAAAA,MAAM,EAAE,IALF;AAMNC,MAAAA,KAAK,EAAE,IAND;AAONC,MAAAA,KAAK,EAAE,EAPD;AAQNC,MAAAA,UAAU,EAAE;AARN,KAF4B;AAAA,SAYpCC,MAZoC,GAY3B1B,KAAK,CAAC2B,SAAN,EAZ2B;;AAAA,SAkBpCC,YAlBoC,GAkBpBC,KAAD,IAAW;AACxB,YAAM;AAAEC,QAAAA,IAAF;AAAQC,QAAAA;AAAR,UAAkBF,KAAK,CAACG,MAA9B;AACA,WAAKC,QAAL,CAAc;AAAE,SAACH,IAAD,GAAQC;AAAV,OAAd;;AAEA,UAAGD,IAAI,KAAK,QAAT,IAAqBC,KAAK,KAAK,EAAlC,EAAsC;AACpC,eAAO,KAAKG,KAAL,CAAW7B,UAAX,CAAsB,EAAtB,EAA0B,CAA1B,CAAP;AACD;AACF,KAzBmC;;AAAA,SA2BpC8B,UA3BoC,GA2BvBC,IAAI,IAAI;AACnB,WAAKH,QAAL,CAAc;AAAEV,QAAAA,KAAK,EAAEa;AAAT,OAAd;AACD,KA7BmC;;AAAA,SA+BpCC,kBA/BoC,GA+BdR,KAAD,IAAW;AAC9BA,MAAAA,KAAK,CAACS,cAAN;AACA,YAAM;AAAEpB,QAAAA;AAAF,UAAa,KAAKD,KAAxB;AACA,WAAKiB,KAAL,CAAW3B,aAAX,CAAyB;AAAEW,QAAAA;AAAF,OAAzB;AACD,KAnCmC;;AAAA,SAqCpCqB,cArCoC,GAqCnB,MAAM;AACrB,WAAKN,QAAL,CAAcO,SAAS,KAAK;AAAErB,QAAAA,YAAY,EAAG,CAACqB,SAAS,CAACrB;AAA5B,OAAL,CAAvB;;AACA,UAAG,KAAKF,KAAL,CAAWE,YAAd,EAA4B;AAC1B,eAAO,KAAKc,QAAL,CAAc;AAAEb,UAAAA,KAAK,EAAE,EAAT;AAAaqB,UAAAA,SAAS,EAAE,EAAxB;AAA4BlB,UAAAA,KAAK,EAAE,EAAnC;AAAuCF,UAAAA,KAAK,EAAE,EAA9C;AAAkDC,UAAAA,MAAM,EAAE;AAA1D,SAAd,CAAP;AACD;AACF,KA1CmC;;AAAA,SA4CpCoB,eA5CoC,GA4CjBb,KAAD,IAAW;AAC3BA,MAAAA,KAAK,CAACS,cAAN;AACA,WAAKL,QAAL,CAAc;AAAEX,QAAAA,MAAM,EAAE;AAAV,OAAd;AACA,YAAM;AAAEhB,QAAAA;AAAF,UAAsB,KAAK4B,KAAjC;AACA,YAAM;AAAEd,QAAAA,KAAF;AAASC,QAAAA,KAAT;AAAgBE,QAAAA;AAAhB,UAA0B,KAAKN,KAArC;AAEA,YAAM0B,IAAI,GAAG,KAAK1B,KAAlB;AACA,YAAM2B,QAAQ,GAAG,CAAE,OAAF,EAAW,OAAX,CAAjB;AACA,YAAMtB,MAAM,GAAGV,cAAc,CAAC+B,IAAD,EAAOC,QAAP,CAA7B;;AAEA,UAAIC,MAAM,CAACC,IAAP,CAAYxB,MAAZ,EAAoByB,MAApB,GAA6B,CAAjC,EAAoC;AAClC,eAAO,KAAKd,QAAL,CAAc;AAAEX,UAAAA;AAAF,SAAd,CAAP;AACD;;AAED,YAAM0B,QAAQ,GAAG,IAAIC,QAAJ,EAAjB,CAd2B,CAe3B;AAEA;;AACA,UAAG1B,KAAH,EAAU;AACR,aAAI,IAAI2B,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG3B,KAAK,CAACwB,MAAzB,EAAiCG,CAAC,EAAlC,EAAsC;AACtCF,UAAAA,QAAQ,CAACG,MAAT,CAAgB5B,KAAK,CAACwB,MAAN,GAAe,CAAf,GAAmB,YAAnB,GAAkC,cAAlD,EAAkExB,KAAK,CAAC2B,CAAD,CAAvE;AACC;AACF;;AAEDF,MAAAA,QAAQ,CAACG,MAAT,CAAgB,OAAhB,EAAyB/B,KAAzB;AACA4B,MAAAA,QAAQ,CAACG,MAAT,CAAgB,aAAhB,EAA+B9B,KAA/B;AAEAf,MAAAA,eAAe,CAAC0C,QAAD,CAAf,CACGI,IADH,CACQT,IAAI,IAAI;AACZ,aAAKJ,cAAL;AACA,eAAO,KAAKL,KAAL,CAAW7B,UAAX,CAAsB,EAAtB,EAA0B,CAA1B,CAAP;AACD,OAJH;AAKD,KA5EmC;;AAAA,SA8EpCgD,gBA9EoC,GA8EhBC,EAAD,IAAQ;AACzB,WAAKpB,KAAL,CAAWqB,OAAX,CAAmBC,IAAnB,CAAwB;AACtBC,QAAAA,QAAQ,EAAG,uBAAsBH,EAAG,EADd;AAEtBrC,QAAAA,KAAK,EAAE;AAAEyC,UAAAA,SAAS,EAAE;AAAb;AAFe,OAAxB;AAID,KAnFmC;AAAA;;AAcpCC,EAAAA,iBAAiB,GAAG;AAClB,SAAKzB,KAAL,CAAW7B,UAAX,CAAsB,EAAtB,EAA0B,CAA1B;AACD;;AAqEDuD,EAAAA,MAAM,GAAG;AACP,UAAM;AAAE1C,MAAAA,MAAF;AAAUC,MAAAA,YAAV;AAAwBC,MAAAA,KAAxB;AAA+BC,MAAAA,KAA/B;AAAsCC,MAAAA;AAAtC,QAAiD,KAAKL,KAA5D;AACA,UAAM;AAAE4C,MAAAA,OAAF;AAAWC,MAAAA,UAAX;AAAuBC,MAAAA,QAAvB;AAAiCC,MAAAA,OAAjC;AAA0CC,MAAAA;AAA1C,QAAoD,KAAK/B,KAA/D;AACA,UAAMgC,WAAW,GAAGrD,eAAe,CAACoD,KAAD,CAAnC;AAEA,wBACE;AAAK,MAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG9C,YAAY,iBACX,oBAAC,KAAD;AAAO,MAAA,OAAO,EAAE,KAAKoB,cAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAC,KAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAG,MAAA,SAAS,EAAC,gBAAb;AAA8B,MAAA,OAAO,EAAE,KAAKA,cAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAA6D,QAA7D,CADF,CADF,eAIE;AAAK,MAAA,SAAS,EAAC,sBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAG,MAAA,SAAS,EAAC,gBAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BADF,CAJF,CADF,eASE;AAAM,MAAA,SAAS,EAAC,MAAhB;AAAuB,MAAA,QAAQ,EAAE,KAAKG,eAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAC,wBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAO,MAAA,SAAS,EAAC,gBAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBADF,CADF,eAIE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AACE,MAAA,IAAI,EAAC,OADP;AAEE,MAAA,KAAK,EAAEtB,KAFT;AAGE,MAAA,QAAQ,EAAE,KAAKQ,YAHjB;AAIE,MAAA,SAAS,EAAC,cAJZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAOE;AAAG,MAAA,SAAS,EAAC,sBAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAqCN,MAAM,GAAGA,MAAM,CAACF,KAAV,GAAmB8C,WAAW,IAAIA,WAAW,CAAC,OAAD,CAAxF,CAPF,CAJF,CADF,eAeE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAO,MAAA,SAAS,EAAC,gBAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BADF,CADF,eAIE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AACE,MAAA,IAAI,EAAC,OADP;AAEE,MAAA,KAAK,EAAE7C,KAFT;AAGE,MAAA,QAAQ,EAAE,KAAKO,YAHjB;AAIE,MAAA,SAAS,EAAC,cAJZ;AAKE,MAAA,WAAW,EAAC,sBALd;AAME,MAAA,IAAI,EAAE,CANR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eASE;AAAG,MAAA,SAAS,EAAC,sBAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAqCN,MAAM,GAAGA,MAAM,CAACD,KAAV,GAAmB6C,WAAW,IAAIA,WAAW,CAAC,aAAD,CAAxF,CATF,CAJF,CAfF,eA+BE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAO,MAAA,SAAS,EAAC,gBAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBADF,CADF,eAIE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,iBAAD;AACE,MAAA,UAAU,EAAE,KAAK/B,UADnB;AAEE,MAAA,KAAK,EAAEb,MAAM,GAAGA,MAAM,CAACc,IAAV,GAAkB8B,WAAW,IAAIA,WAAW,CAAC,cAAD,CAF3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAKE;AAAG,MAAA,SAAS,EAAC,sBAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAqC5C,MAAM,GAAGA,MAAM,CAACc,IAAV,GAAkB8B,WAAW,IAAIA,WAAW,CAAC,cAAD,CAAvF,CALF,EAMGD,KAAK,IAAI,OAAOA,KAAP,KAAiB,QAA1B,iBAAsC;AAAG,MAAA,SAAS,EAAC,iBAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAgCA,KAAhC,CANzC,CAJF,CA/BF,eA4CE;AAAK,MAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAQ,MAAA,SAAS,EAAC,wBAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAEGH,UAAU,iBACT;AAAK,MAAA,SAAS,EAAC,4DAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAHJ,CADF,CA5CF,CATF,CAFJ,eAkEE;AAAK,MAAA,SAAS,EAAC,2CAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAQ,MAAA,SAAS,EAAC,kCAAlB;AAAqD,MAAA,OAAO,EAAE,KAAKvB,cAAnE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BADF,eAII;AAAM,MAAA,QAAQ,EAAE,KAAKF,kBAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AACE,MAAA,IAAI,EAAC,QADP;AAEE,MAAA,IAAI,EAAC,MAFP;AAGE,MAAA,WAAW,EAAC,6BAHd;AAIE,MAAA,SAAS,EAAC,4CAJZ;AAKE,MAAA,KAAK,EAAEnB,MALT;AAME,MAAA,QAAQ,EAAE,KAAKU,YANjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAJJ,CAlEF,eAiFE;AAAK,MAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACCoC,OAAO,iBACJ;AAAK,MAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAC,2EAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAFJ,EAMCH,OAAO,IAAIA,OAAO,CAACd,MAAR,GAAiB,CAA5B,gBACG,uDACE,oBAAC,UAAD;AACE,MAAA,UAAU,EAAEgB,QAAQ,CAACI,QADvB;AAEE,MAAA,IAAI,EAAEJ,QAAQ,CAACK,IAFjB;AAGE,MAAA,KAAK,EAAEL,QAAQ,CAACM,OAHlB;AAIE,MAAA,iBAAiB,EAAE,CAAC7C,KAAD,EAAQ4C,IAAR,KAAiB,KAAKlC,KAAL,CAAW7B,UAAX,CAAsBmB,KAAtB,EAA6B4C,IAA7B,CAJtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAOE;AAAK,MAAA,SAAS,EAAC,aAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACA,oBAAC,SAAD;AACE,MAAA,IAAI,EAAEP,OADR;AAEE,MAAA,OAAO,EAAE/C,OAFX;AAGE,MAAA,IAAI,EAAEiD,QAHR;AAIE,MAAA,UAAU,EAAE,KAAKV,gBAJnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADA,CAPF,CADH,GAkBE,CAACW,OAAD,iBACD;AAAK,MAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,GAAG,EAAEM,OAAO,CAAC,4BAAD,CAAjB;AAAiD,MAAA,GAAG,EAAC,YAArD;AAAkE,MAAA,SAAS,EAAC,WAA5E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAEE;AAAG,MAAA,SAAS,EAAC,sBAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAqCpD,MAAM,KAAK,GAAGqD,IAAH,EAAX,GAAuB,uCAAvB,GAAiE,4BAAtG,CAFF,CAzBF,CAjFF,CADF;AAmHD;;AA7MmC;;AAgNtC,MAAMC,eAAe,GAAIvD,KAAD,IAAW;AACjC,QAAM;AAAEwD,IAAAA,GAAG,EAAE;AAAEC,MAAAA,OAAO,EAAE;AAAEb,QAAAA,OAAF;AAAWI,QAAAA,KAAX;AAAkBF,QAAAA;AAAlB;AAAX;AAAP,MAAqD9C,KAA3D;AAEA,SAAO;AACL+C,IAAAA,OAAO,EAAE7D,qBAAqB,CAACc,KAAD,EAAQb,WAAW,CAACuE,mBAApB,CADzB;AAELb,IAAAA,UAAU,EAAE3D,qBAAqB,CAACc,KAAD,EAAQb,WAAW,CAACwE,yBAApB,CAF5B;AAGLf,IAAAA,OAHK;AAILI,IAAAA,KAJK;AAKLF,IAAAA;AALK,GAAP;AAOD,CAVD;;AAYA,MAAMc,kBAAkB,GAAIC,QAAD,IAAc;AACvC,SAAO;AACLzE,IAAAA,UAAU,EAAE,CAACmB,KAAD,EAAQC,UAAR,KAAuBqD,QAAQ,CAACzE,UAAU,CAACmB,KAAD,EAAQC,UAAR,CAAX,CADtC;AAELnB,IAAAA,eAAe,EAAGyE,OAAD,IAAaD,QAAQ,CAACxE,eAAe,CAACyE,OAAD,CAAhB,CAFjC;AAGLxE,IAAAA,aAAa,EAAGwE,OAAD,IAAaD,QAAQ,CAACvE,aAAa,CAACwE,OAAD,CAAd;AAH/B,GAAP;AAKD,CAND;;AAQA,eAAe7E,UAAU,CAACD,OAAO,CAACuE,eAAD,EAAkBK,kBAAlB,CAAP,CAA6C9D,OAA7C,CAAD,CAAzB","sourcesContent":["import React from 'react';\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { getActionLoadingState } from \"#/store/selectors\";\nimport actionTypes from \"#/store/support/actionTypes\";\nimport { getTickets, createNewTicket, searchTickets } from '#/store/support/actions'\nimport Modal from '#/components/Modal';\nimport DataTable from '#/components/DataTable';\nimport DragDropFileInput from '#/components/DragDropFileInput';\nimport Pagination from '#/components/Pagination';\nimport { validateFields, serializeErrors } from '#/utils'\nimport { columns } from './utils';\nimport './style.scss';\n\nclass Tickets extends React.Component {\n\n  state = {\n    search: '',\n    showNewModal: false,\n    title: '',\n    issue: '',\n    errors: null,\n    files: null,\n    limit: 10,\n    pageNumber: 1,\n  }\n  imgRef = React.createRef();\n\n  componentDidMount() {\n    this.props.getTickets(10, 1);\n  }\n\n  handleChange = (event) => {\n    const { name, value } = event.target\n    this.setState({ [name]: value });\n\n    if(name === 'search' && value === '') {\n      return this.props.getTickets(10, 1);\n    }\n  }\n\n  handleFile = file => {\n    this.setState({ files: file });\n  }\n\n  handleSubmitSearch = (event) => {\n    event.preventDefault();\n    const { search } = this.state;\n    this.props.searchTickets({ search });\n  }\n\n  toggleNewModal = () => {\n    this.setState(prevState => ({ showNewModal : !prevState.showNewModal }));\n    if(this.state.showNewModal) {\n      return this.setState({ title: '', fileNames: [], files: [], issue: '', errors: null })\n    }\n  }\n\n  submitNewTicket = (event) => {\n    event.preventDefault();\n    this.setState({ errors: null });\n    const { createNewTicket } = this.props;\n    const { title, issue, files } = this.state;\n\n    const data = this.state;\n    const required = [ 'title', 'issue'];\n    const errors = validateFields(data, required)\n\n    if (Object.keys(errors).length > 0) {\n      return this.setState({ errors });\n    }\n\n    const formData = new FormData();\n    // const fileToUpload = files && files.length > 1 ? files : files\n\n    //create a method that checks the files size and appends the right key to it\n    if(files) {\n      for(var x = 0; x < files.length; x++) {\n      formData.append(files.length > 1 ? 'attachment' : 'attachment[]', files[x])\n      }\n    }\n\n    formData.append('title', title);\n    formData.append('description', issue);\n\n    createNewTicket(formData)\n      .then(data => {\n        this.toggleNewModal();\n        return this.props.getTickets(10, 1);\n      });\n  }\n\n  naviagetToTicket = (id) => {\n    this.props.history.push({\n      pathname: `/app/support/ticket/${id}`,\n      state: { routeName: 'Support' },\n    })\n  }\n\n  render() {\n    const { search, showNewModal, title, issue, errors } = this.state;\n    const { tickets, newLoading, metadata, loading, error } = this.props;\n    const errorObject = serializeErrors(error);\n\n    return (\n      <div className=\"tickets-page\">\n        {showNewModal &&\n          <Modal onClose={this.toggleNewModal}>\n            <div className=\"row\">\n              <div className=\"col-md-2\">\n                <p className=\"cursor-pointer\" onClick={this.toggleNewModal}>{'< Back'}</p>\n              </div>\n              <div className=\"col-md-8 text-center\">\n                <p className=\"text-deep-blue\">Create New Ticket</p>\n              </div>\n            </div>\n            <form className=\"mt-2\" onSubmit={this.submitNewTicket}>\n              <div className=\"row align-items-center\">\n                <div className=\"col-md-3\">\n                  <label className=\"text-grey mb-0\">Title of Ticket</label>\n                </div>\n                <div className=\"col-md-9\">\n                  <input\n                    name=\"title\"\n                    value={title}\n                    onChange={this.handleChange}\n                    className=\"form-control\"\n                  />\n                  <p className=\"text-error mt-0 mb-0\">{errors ? errors.title : (errorObject && errorObject['title'])}</p>\n                </div>\n              </div>\n              <div className=\"row mt-4\">\n                <div className=\"col-md-3\">\n                  <label className=\"text-grey mb-0\">Describe your issue</label>\n                </div>\n                <div className=\"col-md-9\">\n                  <textarea\n                    name=\"issue\"\n                    value={issue}\n                    onChange={this.handleChange}\n                    className=\"form-control\"\n                    placeholder=\"compose your message\"\n                    rows={6}\n                  />\n                  <p className=\"text-error mt-0 mb-0\">{errors ? errors.issue : (errorObject && errorObject['description'])}</p>\n                </div>\n              </div>\n              <div className=\"row mt-4\">\n                <div className=\"col-md-3\">\n                  <label className=\"text-grey mb-0\">Attach file</label>\n                </div>\n                <div className=\"col-md-9\">\n                  <DragDropFileInput \n                    handleFile={this.handleFile}  \n                    error={errors ? errors.file : (errorObject && errorObject['attachment.0'])} \n                  />\n                  <p className=\"text-error mt-0 mb-0\">{errors ? errors.file : (errorObject && errorObject['attachment.0'])}</p>\n                  {error && typeof error === 'string' && <p className=\"text-error mt-2\">{error}</p>}\n                </div>\n              </div>\n              <div className=\"text-right mt-3\">\n                <button className=\"btn btn-sm btn-primary\">\n                  Submit\n                  {newLoading &&\n                    <div className=\"spinner-border spinner-border-white spinner-border-sm ml-2\"></div>\n                  }\n                </button>\n              </div>\n            </form>\n          </Modal>\n        }\n        <div className=\"d-flex justify-content-end mt-2 flex-wrap\">\n          <button className=\"btn btn-sm btn-primary mr-2 mb-3\" onClick={this.toggleNewModal}>\n            Create new ticket\n          </button>\n            <form onSubmit={this.handleSubmitSearch}>\n              <input\n                name=\"search\"\n                type=\"text\"\n                placeholder=\"&#128269; Search tickets\"\n                className=\"p-2 border-grey border-radius-default mb-3\"\n                value={search}\n                onChange={this.handleChange}\n              />\n            </form>\n        </div>\n        <div className=\"mt-2 card\">\n        {loading &&\n            <div className=\"text-center p-4\">\n              <div className=\"spinner-border spinner-border-primary text-primary spinner-border-md mr-2\"></div>\n            </div>\n          }\n        {tickets && tickets.length > 0 ?\n            <>\n              <Pagination\n                totalPages={metadata.lastPage}\n                page={metadata.page}\n                limit={metadata.perPage}\n                changePageHandler={(limit, page) => this.props.getTickets(limit, page)}\n              />\n              <div className=\"table-class\">\n              <DataTable\n                data={tickets}\n                columns={columns}\n                info={metadata}\n                selectItem={this.naviagetToTicket}\n              />\n              </div>\n            </>\n          :\n          (!loading &&\n          <div className=\"p-5 text-center\">\n            <img src={require('#/assets/icons/receipt.svg')} alt=\"no-tickets\" className=\"img-fluid\" />\n            <p className=\"font-light text-grey\">{search !== ''.trim() ? 'No ticket history matches this search' : 'You have no booked tickets'}</p>\n          </div>)\n        }\n        </div>\n      </div>\n    )\n  }\n}\n\nconst mapStateToProps = (state) => {\n  const { app: { support: { tickets, error, metadata } } } = state;\n\n  return {\n    loading: getActionLoadingState(state, actionTypes.GET_TICKETS_REQUEST),\n    newLoading: getActionLoadingState(state, actionTypes.CREATE_NEW_TICKET_REQUEST),\n    tickets,\n    error,\n    metadata,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    getTickets: (limit, pageNumber) => dispatch(getTickets(limit, pageNumber)),\n    createNewTicket: (payload) => dispatch(createNewTicket(payload)),\n    searchTickets: (payload) => dispatch(searchTickets(payload)),\n  };\n};\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(Tickets));\n"]},"metadata":{},"sourceType":"module"}